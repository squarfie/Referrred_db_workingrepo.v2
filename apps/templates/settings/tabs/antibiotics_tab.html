{% load static %}
{% block stylesheets %}


<link rel="stylesheet" href="{% static 'assets/css/settings.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/arsp.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/header.css' %}">
{% endblock stylesheets %}

{% block settings_content %}
<div class="settings-page-tab">   <!-- NEW wrapper to avoid CSS bleed -->
<div class="card shadow-sm">

            <div class="card-header d-flex justify-content-between align-items-center"
             style="background: linear-gradient(135deg, #e8f5f7 0%, #d1e8ed 100%);
                    border-bottom: 2px solid #d1e8ed;">

            <h5 class="card-title" >
            <i class="fas fa-pills mr-2"></i>
            {% if editing %}Edit{% else %}Add{% endif %} Antibiotics
                 </h5>

            <a href="{% url 'antibiotics_view' %}" class="btn btn-sm btn-primary">
                <i class="fas fa-table mr-1"></i> View All
            </a>
        </div>

    <div class="card-body">

        {% if antibiotic_form %}
        <form method="POST"
              action="{% if editing %}{% url 'edit_antibiotics' pk=antibiotic_form.instance.pk %}{% else %}{% url 'add_antibiotics' %}{% endif %}"
              id="antibioticsform">
            {% csrf_token %}

        

            <!-- Checkboxes -->
            <div class="row mb-4">
                <div class="col-md-3">
                        <!-- Upload -->
                    <button type="button" class="btn btn-secondary mb-4" data-toggle="modal" data-target="#UploadAntibioticsModal">
                        <i class="fas fa-file-upload mr-1"></i> Upload CSV/Excel
                    </button>
                </div>
            
                <div class="col-md-3">
                    <label class="font-weight-bold">Show in Results</label><br>
                    <input type="checkbox" name="Show" {% if antibiotic_form.Show.value %}checked{% endif %}>
                </div>

                <div class="col-md-3">
                    <label class="font-weight-bold">Retest Required</label><br>
                    <input type="checkbox" name="Retest" {% if antibiotic_form.Retest.value %}checked{% endif %}>
                </div>

                <div class="col-md-3">
                    <label class="font-weight-bold">Disk Diffusion</label><br>
                    <input type="checkbox" name="Disk_Abx" {% if antibiotic_form.Disk_Abx.value %}checked{% endif %}>
                </div>
            </div>
         

        <div class="row mt-4">
            <!-- Guidelines -->
            <div class="col-md-6">
                <label><strong>Guidelines</strong></label>
                <select name="Guidelines" class="form-control">
                    <option disabled>Select Guidelines</option>
                    {% for value, label in antibiotic_form.fields.Guidelines.choices %}
                        <option value="{{ value }}" {% if antibiotic_form.Guidelines.value == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Test Method -->
            <div class="col-md-6">
                <label><strong>Test Method</strong></label>
                <select name="Test_Method" class="form-control">
                    <option disabled>Select Method</option>
                    {% for value, label in antibiotic_form.fields.Test_Method.choices %}
                        <option value="{{ value }}" {% if antibiotic_form.Test_Method.value == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            </div>
            <!-- Antibiotic Info -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <label>Antibiotic Name</label>
                    <input class="form-control" name="Antibiotic" value="{{ antibiotic_antibiotic_form.Antibiotic.value }}">
                </div>

                <div class="col-md-6">
                    <label>Antibiotic Code</label>
                    <input class="form-control" name="Abx_code" value="{{ antibiotic_antibiotic_form.Abx_code.value }}">
                </div>
            </div>

            <div class="row mt-3">
                <div class="col-md-4">
                    <label>Potency</label>
                    <input class="form-control" name="Potency" value="{{ antibiotic_antibiotic_form.Potency.value }}">
                </div>

                <div class="col-md-4">
                    <label>WHONET Code</label>
                    <input class="form-control" name="Whonet_Abx" value="{{ antibiotic_antibiotic_form.Whonet_Abx.value }}">
                </div>

                <div class="col-md-4">
                    <label>Tier</label>
                    <input class="form-control" name="Tier" value="{{ antibiotic_antibiotic_form.Tier.value }}">
                </div>
            </div>

            <!-- Class / Subclass -->
            <div class="row mt-3">
                <div class="col-md-4">
                    <label>Class</label>
                    <input class="form-control" name="Class" value="{{ antibiotic_antibiotic_form.Class.value }}">
                </div>

                <div class="col-md-4">
                    <label>Subclass</label>
                    <input class="form-control" name="Subclass" value="{{ antibiotic_antibiotic_form.Subclass.value }}">
                </div>

                <div class="col-md-4">
                    <label>Date Modified</label>
                    <input type="date" class="form-control" name="Date_Modified" value="{{ antibiotic_antibiotic_form.Date_Modified.value }}">
                </div>
            </div>

            <!-- Buttons -->
            <div class="text-center mt-4">
                <button class="btn btn-primary px-5">
                    <i class="fas fa-save mr-1"></i>
                    {% if editing %}Update{% else %}Add{% endif %} Antibiotic
                </button>

                <button type="button"
                        onclick="document.getElementById('antibioticsform').reset()"
                        class="btn btn-secondary px-4 ml-2">
                    Clear Form
                </button>
            </div>

        </form>
        {% endif %}

    </div>
</div>
</div>  <!-- Closing the new wrapper div -->

<!-- Upload Modal -->
<div class="modal fade" id="UploadAntibioticsModal" tabindex="-1" role="dialog" aria-labelledby="UploadModalLabel" aria-hidden="true">
  <form method="POST" action="{% url 'upload_antibiotics' %}" enctype="multipart/form-data" onsubmit="return confirmOverwrite();">
    {% csrf_token %}
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content" style="border-top: 4px solid #2d9cad;">
        <div class="modal-header" style="background: linear-gradient(135deg, #e8f5f7 0%, #d1e8ed 100%);">
          <h5 class="modal-title" style="color: #1a7a8e;">
            <i class="fas fa-file-upload mr-2"></i>Upload Antibiotics
          </h5>
          <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
        </div>

        <div class="modal-body">
          <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle mr-2"></i>
            Uploading will replace all existing antibiotic entries.
          </div>


          <label> <i class="fas fa-file-csv mr-1"></i><strong>Select CSV/Excel File</strong></label>
          {{ abx_upload_form.File_uploadAbx }}
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Upload</button>
        </div>

      </div>
    </div>
  </form>
</div>
{% endblock settings_content %}
